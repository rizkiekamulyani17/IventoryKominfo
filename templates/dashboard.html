{% extends 'base.html' %}

{% block content %}
<div class="dashboard-container">

    <h2 class="dashboard-title">ðŸ“Š Dashboard Inventaris Kominfo</h2>

    <!-- Cards Section -->
    <div class="cards-wrapper">
        <!-- Card Ruangan -->
        <a href="{{ url_for('dashboard_all_ruangan') }}" class="dashboard-card">
            <div class="card-content ruangan-card">
                <div class="icon"><i class="bi bi-building"></i></div>
                <div>
                    <h3>Ruangan</h3>
                    <p>{{ ruangan|length }}</p>
                </div>
            </div>
        </a>

        <!-- Card Barang -->
        <a href="{{ url_for('dashboard_all_barang') }}" class="dashboard-card">
            <div class="card-content barang-card">
                <div class="icon"><i class="bi bi-box-seam"></i></div>
                <div>
                    <h3>Barang</h3>
                    <p>{{ barang|length }}</p>
                </div>
            </div>
        </a>

        <!-- Card Barang Rusak Berat -->
        <a href="{{ url_for('kondisi.detail', kondisi='Rusak Berat') }}" class="dashboard-card">
            <div class="card-content rusak-berat-card">
                <div class="icon"><i class="bi bi-exclamation-triangle"></i></div>
                <div>
                    <h3>Barang Rusak Berat</h3>
                    <p>{{ kondisi.get("Rusak Berat", 0) }}</p>
                </div>
            </div>
        </a>

        <!-- âœ… Card Barang Dilelang -->
        <a href="{{ url_for('lelang_bp.dashboard') }}" class="dashboard-card">
            <div class="card-content barang-lelang-card">
                <div class="icon"><i class="bi bi-cash-stack"></i></div>
                <div>
                    <h3>Barang Dilelang</h3>
                    <p>{{ total_selesai }}</p>
                </div>
            </div>
        </a>

        <!-- Card Barang Kurang Baik -->
        <a href="{{ url_for('kondisi.detail', kondisi='Kurang Baik') }}" class="dashboard-card">
            <div class="card-content rusak-ringan-card">
                <div class="icon"><i class="bi bi-exclamation-circle"></i></div>
                <div>
                    <h3>Barang Kurang Baik</h3>
                    <p>{{ kondisi.get("Kurang Baik", 0) }}</p>
                </div>
            </div>
        </a>

        <!-- Card Barang Baik -->
        <a href="{{ url_for('kondisi.detail', kondisi='Baik') }}" class="dashboard-card">
            <div class="card-content barang-baik-card">
                <div class="icon"><i class="bi bi-check-circle"></i></div>
                <div>
                    <h3>Barang Baik</h3>
                    <p>{{ kondisi.get("Baik", 0) }}</p>
                </div>
            </div>
        </a>
    </div>

    <!-- Grafik & Pie Chart berdampingan -->
    <div class="charts-wrapper">
        <!-- Line Chart -->
        <div class="chart-container">
            <h3>ðŸ“ˆ Jumlah Barang per Ruangan</h3>
            <canvas id="barangChart"></canvas>
        </div>

        <!-- Pie Chart -->
        <div class="chart-container small">
            <h3>ðŸ“Š Kondisi Barang</h3>
            <canvas id="kondisiBarangChart"></canvas>
        </div>
    </div>
</div>

<!-- ================== STYLE ================== -->
<style>
.dashboard-container {
    padding: 30px;
    font-family: 'Segoe UI', sans-serif;
    background: #f4f6f9;
    min-height: 100vh;
}

.dashboard-title {
    margin-bottom: 40px;
    color: #1f2937;
    font-weight: 700;
}

.cards-wrapper {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: flex-start;
}

.dashboard-card {
    text-decoration: none;
    color: inherit;
    flex: 0 1 250px;
}

.card-content {
    display: flex;
    align-items: center;
    border-radius: 10px;
    padding: 20px;
    color: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    cursor: pointer;
    min-height: 100px;
}

.card-content .icon {
    font-size: 36px;
    margin-right: 15px;
}

.card-content h3 {
    margin: 0;
    font-weight: 600;
    font-size: 16px;
}

.card-content p {
    margin: 5px 0 0 0;
    font-size: 22px;
    font-weight: 700;
}

/* Warna sesuai AdminLTE */
.ruangan-card { background:#007bff; }
.barang-card { background:#28a745; }
.rusak-berat-card { background:#dc3545; }
.barang-lelang-card { background:#6f42c1; } /* ðŸ’œ Tambahan untuk Barang Dilelang */
.rusak-ringan-card { background:#ffc107; color:#212529; }
.barang-baik-card { background:#17a2b8; }

.card-content:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

/* Charts berdampingan */
.charts-wrapper {
    margin-top: 50px;
    display: flex;
    gap: 30px;
    flex-wrap: wrap;
}

.chart-container {
    flex: 1;
    min-width: 450px;
    background: #ffffff;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}

.chart-container h3 {
    margin-bottom: 20px;
    font-size: 16px;
    font-weight: 600;
    color: #374151;
}

.chart-container.small {
    max-width: 400px;
}
</style>

<!-- ================== SCRIPT ================== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Line Chart Jumlah Barang per Ruangan
const ctx = document.getElementById('barangChart').getContext('2d');
const gradientStroke = ctx.createLinearGradient(0,0,0,400);
gradientStroke.addColorStop(0, '#007bff');
gradientStroke.addColorStop(1, '#28a745');
const gradientFill = ctx.createLinearGradient(0,0,0,400);
gradientFill.addColorStop(0, 'rgba(0,123,255,0.3)');
gradientFill.addColorStop(1, 'rgba(40,167,69,0.05)');

new Chart(ctx, {
    type: 'line',
    data: {
        labels: [{% for r in ruangan %}'{{ r.nama_ruangan }}',{% endfor %}],
        datasets: [{
            label: 'Jumlah Barang',
            data: [{% for r in ruangan %}{{ r.total_barang|default(0) }},{% endfor %}],
            fill: true,
            backgroundColor: gradientFill,
            borderColor: gradientStroke,
            borderWidth: 3,
            tension: 0.4,
            pointBackgroundColor: '#ffffff',
            pointBorderColor: '#007bff',
            pointRadius: 4,
            pointHoverRadius: 7
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display:true, position:'top' },
            tooltip: {
                mode: 'index',
                intersect: false,
                backgroundColor: '#1f2937',
                titleColor: '#fff',
                bodyColor: '#fff',
                padding: 10,
                cornerRadius: 6
            }
        },
        interaction: { mode: 'nearest', axis:'x', intersect:false },
        scales: {
            y: { beginAtZero:true, ticks: { stepSize:1 } },
            x: { ticks:{ font:{size:12} } }
        }
    }
});

// Pie Chart Kondisi Barang
const pieCtx = document.getElementById('kondisiBarangChart').getContext('2d');
new Chart(pieCtx, {
    type: 'pie',
    data: {
        labels: ['Barang Rusak Berat', 'Barang Kurang Baik', 'Barang Baik'],
        datasets: [{
            data: [
                {{ kondisi.get("Rusak Berat", 0) }},
                {{ kondisi.get("Kurang Baik", 0) }},
                {{ kondisi.get("Baik", 0) }}
            ],
            backgroundColor: ['#dc3545', '#ffc107', '#17a2b8'],
            borderColor: '#fff',
            borderWidth: 2
        }]
    },
    options: {
        responsive:true,
        plugins: {
            legend:{ position:'bottom' }
        }
    }
});
</script>
{% endblock %}
