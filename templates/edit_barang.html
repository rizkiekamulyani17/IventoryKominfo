{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h2>Edit Barang</h2>
    <form method="POST" enctype="multipart/form-data"> <!-- ðŸ”¹ wajib -->
        <div class="form-group mb-2">
            <label>Kode Barang</label>
            <input type="text" name="kode_barang" class="form-control" value="{{ barang['kode_barang'] }}" required>
        </div>

        <div class="form-group mb-2">
            <label>Nama Barang</label>
            <input type="text" name="nama_barang" class="form-control" value="{{ barang['nama_barang'] }}" required>
        </div>

        <div class="form-group mb-2">
            <label>Merk/Model</label>
            <input type="text" name="merk" class="form-control" value="{{ barang['merk'] }}">
        </div>

        <div class="form-group mb-2">
            <label>No. Seri Pabrik</label>
            <input type="text" name="no_seri" class="form-control" value="{{ barang['no_seri'] }}">
        </div>

        <div class="form-group mb-2">
            <label>Ukuran</label>
            <input type="text" name="ukuran" class="form-control" value="{{ barang['ukuran'] }}">
        </div>

        <div class="form-group mb-2">
            <label>Bahan</label>
            <input type="text" name="bahan" class="form-control" value="{{ barang['bahan'] }}">
        </div>

        <div class="form-group mb-2">
            <label>Tahun Pembelian</label>
            <input type="number" name="tahun" class="form-control" value="{{ barang['tahun'] }}">
        </div>

        <div class="form-group mb-2">
            <label>Jumlah</label>
            <input type="number" name="jumlah" class="form-control" value="{{ barang['jumlah'] }}">
        </div>

        <div class="form-group mb-2">
            <label>Kondisi</label>
            <select name="kondisi" class="form-control">
                <option value="Baik" {% if barang['kondisi'] == 'Baik' %}selected{% endif %}>Baik</option>
                <option value="Kurang Baik" {% if barang['kondisi'] == 'Kurang Baik' %}selected{% endif %}>Kurang Baik</option>
                <option value="Rusak Berat" {% if barang['kondisi'] == 'Rusak Berat' %}selected{% endif %}>Rusak Berat</option>
            </select>
        </div>

        <div class="form-group mb-2">
            <label>Harga Beli</label>
            <input type="number" name="harga_beli" class="form-control" value="{{ barang['harga_beli'] }}">
        </div>

        <div class="form-group mb-2">
            <label>Ruangan</label>
            <select name="ruangan_id" class="form-control" required>
                {% for r in ruangan_list %}
                    <option value="{{ r['_id'] }}" {% if r['_id'] == barang['ruangan_id'] %}selected{% endif %}>
                        {{ r['nama_ruangan'] }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group mb-2">
            <label for="keterangan">Keterangan</label>
            <textarea class="form-control" id="keterangan" name="keterangan">{{ barang.keterangan }}</textarea>
        </div>

        <!-- ðŸ”¹ Tambah bagian Foto -->
        <div class="mb-3">
            <label class="form-label">Foto Barang</label><br>
            {% if barang.get("foto") %}
                <img src="{{ url_for('static', filename=barang['foto'].replace('static/','')) }}" 
                     alt="Foto Barang" class="img-thumbnail mb-2" width="150">
            {% endif %}
            <input type="file" name="foto" class="form-control" accept="image/*" capture="environment" onchange="previewImage(event)">
            <img id="preview" src="" style="max-height: 150px; display:none;" class="img-thumbnail mt-2">
        </div>

        <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
        <a href="{{ url_for('barang.index', kode=barang['_id']) }}" class="btn btn-secondary">Batal</a>
    </form>
</div>

<script>
function previewImage(event) {
    const [file] = event.target.files;
    if (file) {
        const preview = document.getElementById('preview');
        preview.src = URL.createObjectURL(file);
        preview.style.display = 'block';
    }
}
</script>
{% endblock %}
